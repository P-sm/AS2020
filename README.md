# AtomSkills 2020. IT Solution for business

**Участник:** Рединов Павел Владимирович

## Общие сведения

Web- и desktop-приложения написаны на .netcore 3.1. Desktop-приложение собрано включая в себя бибилиотеку .netcore, а для web-приложения требуется установка .net core 3.1 Hosting Bundle (прилагается). Desktop-приложение представляет из себя браузер, при запуске заходит на страницу авторизации Web-приложения, поэтому в конфиге нужно прописать адрес web-приложения.

### База данных
Тип БД - MS SQL. Создавать вручную БД из дампа не треубется. Используется EntityFramework с подходом code-first. База данных создается при первом запуске desktop-приложения, оно подключается к БД под учетной записью пользователя windows, из-под которого само запущено. Затем пытается создать пустую БД и назначить права доступа к ней для группы пользователей BUILTIN\IIS_IUSRS, для того чтобы web-приложение запущенное в IIS получило доступ к базе. На всякий сучай SQL-скрипт приложен в репозитарии.

### Состав репозитария

* **publish/webApp** -- каталог с собранным web-приложением
* **dotnet-hosting-3.1.6-win.exe** -- .net core 3.1 Hosting Bundle
* **publish/desktopApp** -- каталог с собранным desktop-приложением
* **libcef.7z** -- архив библиотеки размером более 100 МБ, необходимо распковать в desktopApp
* **source** -- каталог c исходным solution для Visual Studio 2019
* **dump.sql** -- дамп БД
* **img** - изображения для readme.md
* **task** - каталог с конкурсным заданием

## Развертывание

### Порядок действий
1. развернуть web-приложение, но не открывать его в браузере, т.к. будет исключени из-за того что web-приложение, запущенное под учетной запиьсю группы IIS не сможет создать базу данных MS SQL
2. настроить desktop-приложение
3. запустить desktop-приложение, при запуске будет создана и настроена БД. Приложение откроет страницу авторизации web-приложения. Если БД не будет создана, запустить приложения от имени Администратора.
4. открыть web-приложение в браузере

### Инструкция по развертыванию web-приложения

Web-приложение запускается в IIS на localhost, на любом доступном порту.

1. установить .net core 3.1 Hosting Bundle (файл *dotnet-hosting-3.1.6-win.exe* в репозитарии)
2. Содержимое каталога **publish/webApp** поместить в папку на локальном диске
3. В корнеовй папке приложения в файле конфигураций **appsettings.json**
в строку начинающуюся с *"ConnectionString"* прописать строку подключания к базе данных MS SQL, например *"Server=localhost\\SQLEXPRESS;Database=webapp1;Trusted_Connection=True;"*
4. В IIS создать новый сайт, заполнить поля:
* Имя сайта -- webapp
* Физический путь -- расположение папки **webApp**
* Прот -- 8080
* Имя узла -- оставить пустым

### Настройка desktop-приложения

1. Содержимое каталога **publish/desktopApp** поместить в папку на локальном диске
2. В корневую папку с приложением распковать архив **libcef.7z** с библиотекой **libcef.dll** (размер более 100 МБ)
3. В корнеовй папке приложения в файле конфигураций **_parameters.json**
в строку начинающуюся с *"ConnectionString"* прописать строку подключания к базе данных MS SQL, например *"Server=localhost\\SQLEXPRESS;Database=webapp1;Trusted_Connection=True;"*
4. Убедится в том, что там же в строке начинающейся с "url" прописан верный URL web-приложения с верным портом, при необходимости отредактировать
5. Для запуска приложения исползуется файл **DronTaxiWindowsForms.exe**

для авторизации ввдети логин **admin** пароль **123**
